ExposedMembers.LuaEvents = LuaEvents

function DoCardFix(playerID:number)
	print("Lua gameplay called")
	local pPlayerCulture:table = Players[playerID]:GetCulture();
	print("pPlayerCulture:GetProgressingCivic()",pPlayerCulture:GetProgressingCivic())
	if pPlayerCulture:GetProgressingCivic() == -1  then
		print("need to assign civc research")
		for i = 0, 58 do
			if (pPlayerCulture:HasCivic(i) == false) then
				pPlayerCulture:SetProgressingCivic(i)
				return
			end	
		end
	end	
end

function NoMoreStack()
	print("No more stack check turn", Game.GetCurrentGameTurn())
	if ( Game.GetCurrentGameTurn() ~= GameConfiguration.GetStartTurn()) then
	for i = 0, PlayerManager.GetAliveMajorsCount() - 1 do
		if (PlayerConfigurations[i]:GetLeaderTypeName() ~= "LEADER_SPECTATOR" and PlayerConfigurations[i]:GetHandicapTypeID() ~= 2021024770) then
			local pPlayerCulture:table = Players[i]:GetCulture();
			if pPlayerCulture:GetProgressingCivic() == -1 and pPlayerCulture:GetCultureYield()>0 then
				print("Player",PlayerConfigurations[i]:GetLeaderTypeName()," forgot to pick a civic")
				for k = 0, 58 do
					if (pPlayerCulture:HasCivic(k) == false) then
						pPlayerCulture:SetProgressingCivic(k)
						break
					end	
				end
			end
			local pPlayerTechs:table = Players[i]:GetTechs();
			if pPlayerTechs:GetResearchingTech() == -1 and pPlayerTechs:GetScienceYield()>0 then
				print("Player",PlayerConfigurations[i]:GetLeaderTypeName()," forgot to pick a tech")
				for k = 0, 73 do
					if (pPlayerTechs:HasTech(k) == false) then
						pPlayerTechs:SetResearchingTech(k)
						break
					end	
				end
			end
		end		
	end
	end	
end

function NoMoreStack2()
	print("No more stack check turn OnGameTurnStarted", Game.GetCurrentGameTurn())
	if ( Game.GetCurrentGameTurn() ~= GameConfiguration.GetStartTurn()) then
	for i = 0, PlayerManager.GetAliveMajorsCount() - 1 do
		if (PlayerConfigurations[i]:GetLeaderTypeName() ~= "LEADER_SPECTATOR" and PlayerConfigurations[i]:GetHandicapTypeID() ~= 2021024770) then
			local pPlayerCulture:table = Players[i]:GetCulture();
			if pPlayerCulture:GetProgressingCivic() == -1 and pPlayerCulture:GetCultureYield()>0 then
				print("Player",PlayerConfigurations[i]:GetLeaderTypeName()," forgot to pick a civic")
				for k = 0, 58 do
					if (pPlayerCulture:HasCivic(k) == false) then
						pPlayerCulture:SetProgressingCivic(k)
						break
					end	
				end
			end
			local pPlayerTechs:table = Players[i]:GetTechs();
			if pPlayerTechs:GetResearchingTech() == -1 and pPlayerTechs:GetScienceYield()>0 then
				print("Player",PlayerConfigurations[i]:GetLeaderTypeName()," forgot to pick a tech")
				for k = 0, 73 do
					if (pPlayerTechs:HasTech(k) == false) then
						pPlayerTechs:SetResearchingTech(k)
						break
					end	
				end
			end
		end		
	end
	end	
end

function Initialize()

print("Culture Stack 2.0")
--LuaEvents.UIDoCardFix.Add ( DoCardFix );
LuaEvents.UINoMoreStack.Add ( NoMoreStack );
GameEvents.OnGameTurnStarted.Add(NoMoreStack2);

end

Initialize();